import React, { Component } from 'react';
import './App.css';
import axios from 'axios';

const Layout = () => {
  return (
    <div className="container">
      <div className="row">
      <div className="col-sm"> </div>
        <div className="col-sm"><h2>Last</h2> </div>
        <div className="col-sm"><h2>First</h2></div>
        <div className="col-sm"><h2>Phone</h2></div>
        <div className="col-sm"><h2>Location</h2></div>
        <div className="col-sm"></div>
      </div>
    </div >
  );
}

const User = (props) => {
    return (
      <div className="cardBlock container"  >
        <div className="row">
          <div className="col-sm">
            <img 
              className="avatar" 
              src={props.picture.large} 
              alt="placeholdr"/>
          </div>

          <div className="col-sm">  
            <div className="last">
              <h3>{props.name.last}  </h3>
            </div>
          </div>
          
          <div className="col-sm">
              <div className="first">
                <h3>{props.name.first}  </h3>
              </div>
          </div>

          <div className="col-sm">
            <div>
              <h3>{props.phone}</h3>
            </div>
          </div>
        
          <div className="col-sm">
            <div>
              <h3>{props.location.state}</h3>
            </div>
          </div>
        
          <div className="col-sm"><button className="btn btn-success plus" onClick={props.toggleView} key={props.login.uuid}>+</button></div>
        
        </div>
      </div>
  );

  
}

const UsersList = (props) => {
  return (
    <div>
      {props.users.map(user => <User 
        key={user.login.uuid} 
        {...user} 
        toggleView={() => props.viewToggled(user.login.uuid)} />)}
    </div>
  );
}

class App extends Component {
  
  state = {
    users:  [
      {
        "name":{"title":"miss","first":"leah","last":"evans"},
        "location":{"street":"3490 white oak dr","city":"geraldton","state":"western australia","postcode":4973},
        "login":{"username":"whitedog585", "uuid": "642d2081-e748-40f1-92d6-firstValue"},
        "phone":"04-8136-4841",
        "id":{"name":"TFN","value":"460173802"},
        "picture":{"large":"https://randomuser.me/api/portraits/women/40.jpg","medium":"https://randomuser.me/api/portraits/med/women/40.jpg",
        "thumbnail":"https://randomuser.me/api/portraits/thumb/women/40.jpg"},
        "key": "initisaluser11231"
      } 
    ],
    visibility: false
  }

  viewToggleHandler = (id) => {
    this.setState ({users: Object.assign({}, this.state.users)});
  }
        
  handleSubmit = event => {
    event.preventDefault();
    axios.get(`https://randomuser.me/api/?inc=picture,name,login,id,phone,location,gender`)
    .then(resp => {
        const person = resp.data.results[0]; 
        this.setState((prevState, props) => ({
          users: prevState.users.concat(person)}
        ));
        
        //console.log(this.state.users);
      })
      .catch((err) => {
        console.log(err);
      });
  }



  render() {
    return (
      <div className="App">
          <Layout />
          <UsersList users={this.state.users} viewToggled={()=> this.arrayToObj()}/>
          
          

          <form onSubmit={this.handleSubmit}>
            <button type="submit">Add</button>
          </form>
      </div>
    );
  }
}

export default App;
